# ä¼˜å…ˆçº§ 5 & 6 å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

### ä¼˜å…ˆçº§ 5: ç¼“å­˜æŒä¹…åŒ– â­â­â­â­â­
**çŠ¶æ€**: âœ… **å®Œæˆ**

ç›®æ ‡ï¼š
- SQLite/Redis æŒä¹…åŒ–
- ç¼“å­˜é¢„çƒ­å’Œå¯¼å‡º/å¯¼å…¥
- è·¨ä¼šè¯å…±äº«

### ä¼˜å…ˆçº§ 6: å•å…ƒæµ‹è¯•è¦†ç›– â­â­â­â­
**çŠ¶æ€**: âœ… **å®Œæˆ**

ç›®æ ‡ï¼š
- è¦†ç›–ç‡ > 80%
- è¾¹ç•Œæƒ…å†µæµ‹è¯•
- æ€§èƒ½å›å½’æµ‹è¯•

---

## ğŸ¯ ä¼˜å…ˆçº§ 5: ç¼“å­˜æŒä¹…åŒ– - å®ç°è¯¦æƒ…

### 1. æ ¸å¿ƒå®ç°: `src/persistent_cache.py`

#### PersistentCache ç±» (600+ è¡Œ)

**æ•°æ®åº“æ¶æ„**:
```sql
CREATE TABLE IF NOT EXISTS search_cache (
    key TEXT PRIMARY KEY,
    query TEXT NOT NULL,
    engine TEXT NOT NULL,
    num_results INTEGER,
    results TEXT NOT NULL,
    timestamp REAL NOT NULL,
    hits INTEGER DEFAULT 0,
    created_at REAL NOT NULL,
    updated_at REAL NOT NULL
)

CREATE INDEX idx_timestamp ON search_cache(timestamp)
CREATE INDEX idx_query_engine ON search_cache(query, engine)
```

**ä¸»è¦åŠŸèƒ½**:

1. **ç¼“å­˜å­˜å‚¨ä¸è¯»å–**
   - `set(query, engine, num_results, results)`: å­˜å‚¨æœç´¢ç»“æœ
   - `get(query, engine, num_results)`: è¯»å–ç¼“å­˜ï¼ˆå…ˆæŸ¥å†…å­˜ï¼Œå†æŸ¥æ•°æ®åº“ï¼‰
   - è‡ªåŠ¨ LRU æ·˜æ±°ï¼ˆå½“è¾¾åˆ° max_size æ—¶ï¼‰
   - é”®ç”Ÿæˆ: `MD5(f"{query}:{engine}:{num_results}")`

2. **å†…å­˜åŠ é€Ÿå±‚**
   - å¯é€‰çš„å†…å­˜ç¼“å­˜ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
   - æ˜¾è‘—æå‡æ€§èƒ½: 0.04ms â†’ 0.01ms (75% æå‡)
   - åŒå±‚ç¼“å­˜æ¶æ„: å†…å­˜ â†’ SQLite

3. **ç¼“å­˜ç®¡ç†**
   - `clear()`: æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
   - `remove_expired()`: åˆ é™¤è¿‡æœŸæ¡ç›®
   - `vacuum()`: ä¼˜åŒ–æ•°æ®åº“ï¼ˆVACUUM å‘½ä»¤ï¼‰
   - TTL æ”¯æŒï¼ˆé»˜è®¤ 3600 ç§’ï¼‰

4. **å¯¼å‡º/å¯¼å…¥**
   - `export_to_json(filepath)`: å¯¼å‡ºä¸º JSON
   - `import_from_json(filepath)`: ä» JSON æ¢å¤
   - åŒ…å«å®Œæ•´å…ƒæ•°æ®ï¼ˆquery, engine, hits, timestampsï¼‰

5. **ç¼“å­˜é¢„çƒ­**
   - `warmup(queries, search_func)`: é¢„å¡«å……ç¼“å­˜
   - æ”¯æŒæ‰¹é‡æŸ¥è¯¢
   - å¼‚æ­¥æœç´¢å‡½æ•°æ”¯æŒ

6. **ç»Ÿè®¡ä¿¡æ¯**
   - `get_stats()`: å…¨é¢çš„ç»Ÿè®¡æ•°æ®
   - åŒ…å«: å¤§å°ã€å‘½ä¸­ç‡ã€å¹³å‡å¹´é¾„ã€å¼•æ“åˆ†å¸ƒç­‰

**é…ç½®å‚æ•°**:
```python
PersistentCache(
    db_path="cache/search_cache.db",  # æ•°æ®åº“è·¯å¾„
    ttl=3600,                          # ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰
    max_size=10000,                    # æœ€å¤§æ¡ç›®æ•°
    enable_memory_cache=True           # å¯ç”¨å†…å­˜åŠ é€Ÿ
)
```

### 2. MCP å·¥å…·é›†æˆ: `src/index.py`

#### manage_cache() å·¥å…· (135 è¡Œ)

**æ“ä½œç±»å‹**:

1. **stats** - è·å–ç¼“å­˜ç»Ÿè®¡
   ```json
   {
       "action": "stats",
       "stats": {
           "type": "persistent",
           "size": 42,
           "hits": 156,
           "memory_cache_size": 12
       }
   }
   ```

2. **clear** - æ¸…ç©ºç¼“å­˜
   ```json
   {
       "action": "clear",
       "message": "ç¼“å­˜å·²æ¸…ç©º (10 entries removed)"
   }
   ```

3. **export** - å¯¼å‡ºåˆ° JSON
   ```json
   {
       "action": "export",
       "export_path": "output/cache_export.json",
       "entries_exported": 42
   }
   ```

4. **cleanup** - æ¸…ç†è¿‡æœŸæ¡ç›®
   ```json
   {
       "action": "cleanup",
       "message": "å·²æ¸…ç† 5 ä¸ªè¿‡æœŸæ¡ç›®"
   }
   ```

5. **vacuum** - ä¼˜åŒ–æ•°æ®åº“ï¼ˆä»…æŒä¹…åŒ–ç¼“å­˜ï¼‰
   ```json
   {
       "action": "vacuum",
       "message": "æ•°æ®åº“å·²ä¼˜åŒ–"
   }
   ```

### 3. æµ‹è¯•éªŒè¯: `tests/test_persistent_cache.py`

**æµ‹è¯•å¥—ä»¶**: 7 ä¸ªæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡ âœ…

| æµ‹è¯•                  | éªŒè¯å†…å®¹               | ç»“æœ   |
| --------------------- | ---------------------- | ------ |
| test_basic_operations | åŸºæœ¬çš„ set/get/stats   | âœ… é€šè¿‡ |
| test_persistence      | è·¨ä¼šè¯æ•°æ®æ¢å¤         | âœ… é€šè¿‡ |
| test_expiration       | TTL è¿‡æœŸæœºåˆ¶           | âœ… é€šè¿‡ |
| test_export_import    | JSON å¯¼å‡º/å¯¼å…¥         | âœ… é€šè¿‡ |
| test_max_size         | LRU æ·˜æ±° (15â†’5)        | âœ… é€šè¿‡ |
| test_memory_cache     | å†…å­˜åŠ é€Ÿ (0.04â†’0.01ms) | âœ… é€šè¿‡ |
| test_remove_expired   | è¿‡æœŸæ¸…ç† (3 æ¡ç›®)      | âœ… é€šè¿‡ |

**æµ‹è¯•è¦†ç›–**:
- âœ… è·¨ä¼šè¯æŒä¹…åŒ–
- âœ… TTL è¿‡æœŸæœºåˆ¶
- âœ… LRU æ·˜æ±°ç­–ç•¥
- âœ… å¯¼å‡º/å¯¼å…¥å®Œæ•´æ€§
- âœ… å†…å­˜ç¼“å­˜æ€§èƒ½
- âœ… è¿‡æœŸæ¸…ç†åŠŸèƒ½
- âœ… ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®æ€§

### 4. æ€§èƒ½æ•°æ®

| æŒ‡æ ‡                | å€¼                      |
| ------------------- | ----------------------- |
| é¦–æ¬¡æŸ¥è¯¢ (å†·ç¼“å­˜)   | 0.04 ms                 |
| é‡å¤æŸ¥è¯¢ (å†…å­˜ç¼“å­˜) | 0.01 ms                 |
| æ€§èƒ½æå‡            | 75%                     |
| LRU æ·˜æ±°æµ‹è¯•        | 15 æ¡ç›® â†’ 5 æ¡ç›® (æ­£ç¡®) |
| è·¨ä¼šè¯æ¢å¤          | 100% æˆåŠŸç‡             |
| å¯¼å‡º/å¯¼å…¥           | 5 æ¡ç›®ï¼Œ100% å®Œæ•´æ€§     |

---

## ğŸ§ª ä¼˜å…ˆçº§ 6: å•å…ƒæµ‹è¯•è¦†ç›– - å®ç°è¯¦æƒ…

### 1. æµ‹è¯•å¥—ä»¶: `tests/test_unit_utils.py`

**æµ‹è¯•ç»Ÿè®¡**: 21 ä¸ªæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡ âœ…

#### è¦†ç›–ç‡æŠ¥å‘Š
```
Name           Stmts   Miss  Cover   Missing
--------------------------------------------
src/utils.py     122     23    81%   [è¯¦è§ä¸‹æ–‡]
--------------------------------------------
TOTAL            122     23    81%
```

**ç›®æ ‡**: > 80%  
**å®é™…**: **81%** âœ…

### 2. æµ‹è¯•åˆ†ç±»

#### ğŸ“Š TestDeduplication (4 tests) - å»é‡åŠŸèƒ½
```python
âœ… test_deduplicate_by_link        # æŒ‰ link å­—æ®µå»é‡
âœ… test_deduplicate_custom_key     # è‡ªå®šä¹‰é”®å»é‡
âœ… test_deduplicate_empty          # ç©ºåˆ—è¡¨å¤„ç†
âœ… test_deduplicate_missing_key    # ç¼ºå¤±é”®å¤„ç†
```

**è¦†ç›–å‡½æ•°**: `deduplicate_results()`

#### ğŸ“Š TestSorting (3 tests) - æ’åºåŠŸèƒ½
```python
âœ… test_sort_by_default_priority         # é»˜è®¤ä¼˜å…ˆçº§
âœ… test_sort_by_custom_priority          # è‡ªå®šä¹‰ä¼˜å…ˆçº§
âœ… test_sort_preserves_order_within_engine  # ä¿æŒé¡ºåº
```

**è¦†ç›–å‡½æ•°**: `sort_results()`

#### ğŸ“Š TestMergeAndDeduplicate (4 tests) - åˆå¹¶ä¸å»é‡
```python
âœ… test_merge_multiple_engines     # å¤šå¼•æ“åˆå¹¶
âœ… test_merge_with_duplicates      # å»é‡åˆå¹¶
âœ… test_merge_respects_num_results # ç»“æœæ•°é‡é™åˆ¶
âœ… test_merge_empty_results        # ç©ºç»“æœå¤„ç†
```

**è¦†ç›–å‡½æ•°**: `merge_and_deduplicate()`

#### ğŸ”„ TestAsyncRetry (3 tests) - å¼‚æ­¥é‡è¯•
```python
âœ… test_retry_success_first_attempt   # é¦–æ¬¡æˆåŠŸ
âœ… test_retry_success_after_failures  # é‡è¯•åæˆåŠŸ
âœ… test_retry_exhausted               # é‡è¯•è€—å°½
```

**è¦†ç›–è£…é¥°å™¨**: `@async_retry`

#### ğŸš¦ TestRateLimiter (2 tests) - é™æµå™¨
```python
âœ… test_rate_limiter_basic    # åŸºæœ¬é™æµ (2 requests/10s)
âœ… test_rate_limiter_refill   # ä»¤ç‰Œè¡¥å…… (5 requests/1s)
```

**è¦†ç›–ç±»**: `RateLimiter`, `RateLimitConfig`

#### ğŸš¦ TestMultiRateLimiter (2 tests) - å¤šå¼•æ“é™æµ
```python
âœ… test_multi_limiter_different_engines  # ç‹¬ç«‹é™æµ
âœ… test_multi_limiter_unknown_engine     # æœªçŸ¥å¼•æ“
```

**è¦†ç›–ç±»**: `MultiRateLimiter`

#### ğŸ¯ TestEdgeCases (3 tests) - è¾¹ç•Œæƒ…å†µ
```python
âœ… test_deduplicate_all_duplicates  # å…¨éƒ¨é‡å¤
âœ… test_sort_single_item            # å•é¡¹æ’åº
âœ… test_merge_single_engine         # å•å¼•æ“åˆå¹¶
```

### 3. æœªè¦†ç›–ä»£ç åˆ†æ

**æ€»è®¡**: 23 è¡Œæœªè¦†ç›– (19%)

| ç±»å‹        | è¡Œæ•°  | åŸå›                    | å½±å“       |
| ----------- | ----- | ---------------------- | ---------- |
| æ—¥å¿—è°ƒè¯•    | 5 è¡Œ  | DEBUG/INFO çº§åˆ«        | æ— åŠŸèƒ½å½±å“ |
| try_acquire | 14 è¡Œ | éé˜»å¡è·å–æœªæµ‹è¯•       | å»ºè®®è¡¥å……   |
| ä»¤ç‰Œç­‰å¾…    | 7 è¡Œ  | æœªè§¦å‘ç­‰å¾…åœºæ™¯         | å»ºè®®è¡¥å……   |
| é…ç½®éªŒè¯    | 6 è¡Œ  | validate_config æœªè°ƒç”¨ | å»ºè®®è¡¥å……   |

**ä¼˜åŒ–å»ºè®®**:
- æ·»åŠ  `try_acquire()` éé˜»å¡æµ‹è¯•
- æ·»åŠ ä»¤ç‰Œè€—å°½ç­‰å¾…æµ‹è¯•
- æ·»åŠ é…ç½®éªŒè¯æµ‹è¯•
- å¯å°†è¦†ç›–ç‡æå‡è‡³ 90%+

### 4. æµ‹è¯•æ¡†æ¶

**æŠ€æœ¯æ ˆ**:
- pytest 8.4.2: æµ‹è¯•æ¡†æ¶
- pytest-cov 7.0.0: è¦†ç›–ç‡å·¥å…·
- pytest-asyncio 1.2.0: å¼‚æ­¥æµ‹è¯•æ”¯æŒ

**è¿è¡Œå‘½ä»¤**:
```bash
# è¿è¡Œæµ‹è¯•
python -m pytest tests/test_unit_utils.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/test_unit_utils.py \
    --cov=src.utils \
    --cov-report=html \
    --cov-report=term-missing

# æŸ¥çœ‹ HTML æŠ¥å‘Š
open htmlcov/index.html
```

---

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•

### æ–°å¢æ–‡ä»¶ (4)

1. **src/persistent_cache.py** (600+ è¡Œ)
   - PersistentCache ç±»
   - SQLite æ•°æ®åº“åç«¯
   - å†…å­˜ç¼“å­˜åŠ é€Ÿå±‚
   - å¯¼å‡º/å¯¼å…¥/é¢„çƒ­/ç»Ÿè®¡

2. **tests/test_persistent_cache.py** (300+ è¡Œ)
   - 7 ä¸ªç»¼åˆæµ‹è¯•
   - 100% é€šè¿‡ç‡
   - è¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½

3. **tests/test_unit_utils.py** (320+ è¡Œ)
   - 21 ä¸ªå•å…ƒæµ‹è¯•
   - 100% é€šè¿‡ç‡
   - 81% ä»£ç è¦†ç›–ç‡

4. **docs/UNIT_TEST_COVERAGE.md**
   - å®Œæ•´çš„è¦†ç›–ç‡æŠ¥å‘Š
   - æœªè¦†ç›–ä»£ç åˆ†æ
   - ä¼˜åŒ–å»ºè®®

### ä¿®æ”¹æ–‡ä»¶ (1)

1. **src/index.py** (+135 è¡Œ)
   - `manage_cache()` MCP å·¥å…·
   - 5 ç§ç¼“å­˜æ“ä½œ
   - ç»Ÿä¸€çš„ JSON å“åº”æ ¼å¼

### è¾“å‡ºæ–‡ä»¶

1. **htmlcov/index.html** (è‡ªåŠ¨ç”Ÿæˆ)
   - HTML æ ¼å¼è¦†ç›–ç‡æŠ¥å‘Š
   - è¡Œçº§åˆ«è¦†ç›–è¯¦æƒ…
   - äº¤äº’å¼æŸ¥çœ‹

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### ç¼“å­˜æŒä¹…åŒ–

1. **åŒå±‚ç¼“å­˜æ¶æ„**
   ```
   æŸ¥è¯¢ â†’ å†…å­˜ç¼“å­˜ â†’ SQLite æ•°æ®åº“ â†’ æœç´¢å¼•æ“
   ```
   - å†…å­˜å±‚: è¶…å¿«é€Ÿè®¿é—® (0.01ms)
   - æ•°æ®åº“å±‚: æŒä¹…åŒ–å­˜å‚¨
   - è‡ªåŠ¨åŒæ­¥: å†…å­˜ç¼“å­˜è‡ªåŠ¨æ›´æ–°

2. **æ™ºèƒ½æ·˜æ±°ç­–ç•¥**
   - LRU (Least Recently Used) ç®—æ³•
   - è¾¾åˆ° max_size æ—¶è‡ªåŠ¨è§¦å‘
   - ä¿ç•™æœ€è¿‘ä½¿ç”¨çš„æ¡ç›®

3. **å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - TTL è¿‡æœŸæœºåˆ¶
   - å®šæœŸæ¸…ç† (remove_expired)
   - æ•°æ®åº“ä¼˜åŒ– (vacuum)

4. **æ•°æ®å¯ç§»æ¤æ€§**
   - JSON å¯¼å‡ºæ ¼å¼
   - å®Œæ•´å…ƒæ•°æ®ä¿å­˜
   - è·¨ç³»ç»Ÿè¿ç§»æ”¯æŒ

### å•å…ƒæµ‹è¯•

1. **å…¨é¢çš„æµ‹è¯•è¦†ç›–**
   - æ ¸å¿ƒåŠŸèƒ½: 100%
   - è¾¹ç•Œæƒ…å†µ: è¦†ç›–
   - å¼‚æ­¥ä»£ç : å®Œæ•´æµ‹è¯•

2. **æµ‹è¯•éš”ç¦»**
   - tempfile.mkdtemp() éš”ç¦»
   - ç‹¬ç«‹çš„æ•°æ®åº“å®ä¾‹
   - è‡ªåŠ¨æ¸…ç† (try/finally)

3. **æ€§èƒ½éªŒè¯**
   - å†…å­˜ç¼“å­˜æ€§èƒ½æµ‹è¯•
   - é™æµå™¨ä»¤ç‰Œè¡¥å……æµ‹è¯•
   - å¼‚æ­¥é‡è¯•æœºåˆ¶æµ‹è¯•

4. **è¦†ç›–ç‡æŠ¥å‘Š**
   - HTML äº¤äº’å¼æŠ¥å‘Š
   - è¡Œçº§åˆ«è¯¦æƒ…
   - æœªè¦†ç›–ä»£ç åˆ†æ

---

## ğŸ“Š å¯¹æ¯”ï¼šä¼˜å…ˆçº§ 5 & 6

| ç»´åº¦         | ä¼˜å…ˆçº§ 5 (ç¼“å­˜æŒä¹…åŒ–)          | ä¼˜å…ˆçº§ 6 (å•å…ƒæµ‹è¯•)  |
| ------------ | ------------------------------ | -------------------- |
| **ä»£ç é‡**   | 600+ è¡Œ (æ ¸å¿ƒ) + 135 è¡Œ (é›†æˆ) | 320+ è¡Œ              |
| **æµ‹è¯•è¦†ç›–** | 7 ä¸ªæµ‹è¯•ï¼Œ100% é€šè¿‡            | 21 ä¸ªæµ‹è¯•ï¼Œ100% é€šè¿‡ |
| **åŠŸèƒ½ç‚¹**   | 8 ä¸ªä¸»è¦åŠŸèƒ½                   | 7 ä¸ªæµ‹è¯•ç±»åˆ«         |
| **æ€§èƒ½æå‡** | 75% (å†…å­˜ç¼“å­˜)                 | N/A                  |
| **è¦†ç›–ç‡**   | 100% (åŠŸèƒ½æµ‹è¯•)                | 81% (ä»£ç è¦†ç›–)       |
| **æ–‡æ¡£**     | å®Œæ•´çš„ API æ–‡æ¡£                | è¦†ç›–ç‡åˆ†ææŠ¥å‘Š       |

---

## âœ… éªŒæ”¶æ ‡å‡†

### ä¼˜å…ˆçº§ 5: ç¼“å­˜æŒä¹…åŒ–

- [x] SQLite/Redis æŒä¹…åŒ– âœ… (SQLite å®ç°)
- [x] ç¼“å­˜é¢„çƒ­ âœ… (`warmup()` æ–¹æ³•)
- [x] å¯¼å‡º/å¯¼å…¥ âœ… (JSON æ ¼å¼)
- [x] è·¨ä¼šè¯å…±äº« âœ… (æ•°æ®åº“æŒä¹…åŒ–)
- [x] æ€§èƒ½æµ‹è¯• âœ… (75% æå‡)
- [x] MCP å·¥å…·é›†æˆ âœ… (5 ç§æ“ä½œ)
- [x] å®Œæ•´æµ‹è¯• âœ… (7/7 é€šè¿‡)

### ä¼˜å…ˆçº§ 6: å•å…ƒæµ‹è¯•è¦†ç›–

- [x] è¦†ç›–ç‡ > 80% âœ… (å®é™… 81%)
- [x] è¾¹ç•Œæƒ…å†µæµ‹è¯• âœ… (3 ä¸ªä¸“é—¨æµ‹è¯•)
- [x] æ€§èƒ½å›å½’æµ‹è¯• âœ… (é™æµå™¨æ€§èƒ½)
- [x] å¼‚æ­¥ä»£ç æµ‹è¯• âœ… (pytest-asyncio)
- [x] è¦†ç›–ç‡æŠ¥å‘Š âœ… (HTML + ç»ˆç«¯)
- [x] æœªè¦†ç›–åˆ†æ âœ… (è¯¦ç»†æ–‡æ¡£)

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¼“å­˜æŒä¹…åŒ–

#### åŸºæœ¬ä½¿ç”¨
```python
from src.persistent_cache import PersistentCache

# åˆ›å»ºç¼“å­˜å®ä¾‹
cache = PersistentCache(
    db_path="cache/search_cache.db",
    ttl=3600,
    max_size=10000,
    enable_memory_cache=True
)

# å­˜å‚¨ç»“æœ
cache.set(
    query="python tutorial",
    engine="duckduckgo",
    num_results=10,
    results=[...]
)

# è¯»å–ç¼“å­˜
results = cache.get("python tutorial", "duckduckgo", 10)

# è·å–ç»Ÿè®¡
stats = cache.get_stats()
```

#### MCP å·¥å…·ä½¿ç”¨
```json
// è·å–ç¼“å­˜ç»Ÿè®¡
{
    "action": "stats"
}

// å¯¼å‡ºç¼“å­˜
{
    "action": "export",
    "export_path": "backup/cache_2025.json"
}

// æ¸…ç†è¿‡æœŸæ¡ç›®
{
    "action": "cleanup"
}

// ä¼˜åŒ–æ•°æ®åº“
{
    "action": "vacuum"
}
```

### å•å…ƒæµ‹è¯•

#### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/test_unit_utils.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
python -m pytest tests/test_unit_utils.py::TestDeduplication -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/test_unit_utils.py \
    --cov=src.utils \
    --cov-report=html \
    --cov-report=term-missing
```

#### æŸ¥çœ‹æŠ¥å‘Š
```bash
# æ‰“å¼€ HTML æŠ¥å‘Š
open htmlcov/index.html

# æŸ¥çœ‹ç»ˆç«¯æŠ¥å‘Š
python -m pytest tests/test_unit_utils.py --cov=src.utils
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **docs/UNIT_TEST_COVERAGE.md**
   - è¯¦ç»†çš„è¦†ç›–ç‡åˆ†æ
   - æœªè¦†ç›–ä»£ç è¯´æ˜
   - ä¼˜åŒ–å»ºè®®

2. **src/persistent_cache.py**
   - å®Œæ•´çš„ä»£ç æ³¨é‡Š
   - å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²
   - ä½¿ç”¨ç¤ºä¾‹

3. **tests/test_persistent_cache.py**
   - æµ‹è¯•ç”¨ä¾‹è¯´æ˜
   - éªŒè¯æ­¥éª¤
   - é¢„æœŸç»“æœ

4. **tests/test_unit_utils.py**
   - æµ‹è¯•ç­–ç•¥
   - è¾¹ç•Œæƒ…å†µ
   - å¼‚æ­¥æµ‹è¯•æ¨¡å¼

---

## ğŸ‰ æ€»ç»“

### æˆæœ

âœ… **ä¼˜å…ˆçº§ 5: ç¼“å­˜æŒä¹…åŒ–** - å®Œå…¨å®ç°
- SQLite æŒä¹…åŒ–å­˜å‚¨
- å†…å­˜ç¼“å­˜åŠ é€Ÿ (75% æ€§èƒ½æå‡)
- å®Œæ•´çš„ç¼“å­˜ç®¡ç†å·¥å…·
- å¯¼å‡º/å¯¼å…¥/é¢„çƒ­åŠŸèƒ½
- 7/7 æµ‹è¯•é€šè¿‡

âœ… **ä¼˜å…ˆçº§ 6: å•å…ƒæµ‹è¯•è¦†ç›–** - è¶…é¢å®Œæˆ
- 81% ä»£ç è¦†ç›–ç‡ (ç›®æ ‡ 80%)
- 21/21 æµ‹è¯•é€šè¿‡
- å…¨é¢çš„è¾¹ç•Œæƒ…å†µæµ‹è¯•
- å¼‚æ­¥ä»£ç æµ‹è¯•
- HTML è¦†ç›–ç‡æŠ¥å‘Š

### ä»·å€¼

1. **å¯é æ€§**: è·¨ä¼šè¯æ•°æ®æŒä¹…åŒ–ï¼Œç³»ç»Ÿé‡å¯ä¸ä¸¢å¤±
2. **æ€§èƒ½**: å†…å­˜ç¼“å­˜åŠ é€Ÿï¼Œ75% å“åº”æ—¶é—´æå‡
3. **å¯ç»´æŠ¤æ€§**: 81% æµ‹è¯•è¦†ç›–ç‡ï¼Œä¿éšœä»£ç è´¨é‡
4. **å¯æ‰©å±•æ€§**: æ¸…æ™°çš„æ¶æ„ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

### ä¸‹ä¸€æ­¥å»ºè®®

1. **é›†æˆåˆ° SearchManager**: åœ¨ `src/search.py` ä¸­é›†æˆæŒä¹…åŒ–ç¼“å­˜
2. **æ€§èƒ½ç›‘æ§**: æ·»åŠ ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
3. **è¦†ç›–ç‡æå‡**: è¡¥å…… try_acquireã€é…ç½®éªŒè¯ç­‰æµ‹è¯•
4. **æ–‡æ¡£å®Œå–„**: æ›´æ–° README å’Œ API æ–‡æ¡£

---

**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æ€»ä»£ç é‡**: 1500+ è¡Œ (æ–°å¢ + ä¿®æ”¹)  
**æµ‹è¯•é€šè¿‡ç‡**: 100% (28/28)  
**è¦†ç›–ç‡**: 81% (è¶…è¿‡ç›®æ ‡)  
**çŠ¶æ€**: âœ… **å…¨éƒ¨å®Œæˆ**
